var MarkdownDeep=new function(){"use strict";function a(a,b){if(void 0!==a.indexOf)return a.indexOf(b);for(var c=0;c<a.length;c++)if(a[c]===b)return c;return-1}function b(){this.spanFormatter=new I(this),this.spareBlocks=[],this.stringBuilder=new w,this.stringBuilderFinal=new w}function c(a,b,c,d){return a.slice(0,b).concat(d).concat(a.slice(b+c))}function d(a){return a>="0"&&"9">=a}function e(a){return a>="0"&&"9">=a||a>="a"&&"f">=a||a>="A"&&"F">=a}function f(a){return a>="a"&&"z">=a||a>="A"&&"Z">=a}function g(a){return a>="a"&&"z">=a||a>="A"&&"Z">=a||a>="0"&&"9">=a}function h(a){return" "===a||"	"===a||"\r"===a||"\n"===a}function i(a){return" "===a||"	"===a}function j(a){return"\r"===a||"\n"===a}function k(a){return"*"===a||"_"===a}function l(a,b){switch(a){case"\\":case"`":case"*":case"_":case"{":case"}":case"[":case"]":case"(":case")":case">":case"#":case"+":case"-":case".":case"!":return!0;case":":case"|":case"=":case"<":return b}return!1}function m(a,b){if("&"!==a.charAt(b))return-1;b++;var c;if("#"===a.charAt(b)?(b++,"x"===a.charAt(b)||"X"===a.charAt(b)?(b++,c=e):c=d):c=g,c(a.charAt(b))){for(b++;c(a.charAt(b));)b++;if(";"===a.charAt(b))return b++,b}return-1}function n(a,b){var c,d,e=a.indexOf("\\");if(0>e)return a;for(c=new w,d=0;e>=0;)l(a.charAt(e+1),b)&&(e>d&&c.Append(a.substr(d,e-d)),d=e+1),e=a.indexOf("\\",e+1);return d<a.length&&c.Append(a.substr(d,a.length-d)),c.ToString()}function o(a){for(var b=0,c=a.length;c>b&&h(a.charAt(b));)b++;for(;c-1>b&&h(a.charAt(c-1));)c--;return a.substr(b,c-b)}function p(a){var b,c=a.indexOf("@");return 0>c?!1:(b=a.lastIndexOf("."),!(c>b))}function q(a){return a=a.toLowerCase(),"http://"===a.substr(0,7)?!0:"https://"===a.substr(0,8)?!0:"ftp://"===a.substr(0,6)?!0:"file://"===a.substr(0,7)}function r(a){var b,c;if(!a)return!1;if(!f(a.charAt(0)))return!1;for(b=0;b<a.length;b++)if(c=a.charAt(b),!g(c)&&"_"!==c&&"-"!==c&&":"!==c&&"."!==c)return!1;return!0}function s(a,b,c){for(var d,e,f,g=c-1;g>=b&&h(a.charAt(g));)g--;if(b>g||"}"!==a.charAt(g))return null;for(d=g,g--;g>=b&&"{"!==a.charAt(g);)g--;if(b>g||"#"!==a.charAt(g+1))return null;if(e=g+2,f=a.substr(e,d-e),!r(f))return null;for(;g>b&&h(a.charAt(g-1));)g--;return{id:f,end:g}}function t(a,b){return a.substr(0,b.length)===b}function u(a,b){return a.substr(-b.length)===b}function v(a){return a.indexOf("://")>=0||t(a,"mailto:")}function w(){this.content=[]}function x(){this.reset.apply(this,arguments)}function y(a){this.name=a,this.attributes={},this.flags=0,this.closed=!1,this.closing=!1}function z(a){return a=a.toLowerCase(),"http://"===a.substr(0,7)||"https://"===a.substr(0,8)||"ftp://"===a.substr(0,6)}function A(a){var b,c=a.position;return b=B(a),null!==b?b:(a.position=c,null)}function B(a){var b,c,d,e;if("<"!==a.current())return null;if(a.SkipForward(1),a.SkipString("!--")&&(a.Mark(),a.Find("-->")))return e=new y("!"),e.attributes.content=a.Extract(),e.closed=!0,a.SkipForward(3),e;if(b=a.SkipChar("/"),a.Mark(),!a.SkipIdentifier())return null;if(c=new y(a.Extract()),c.closing=b,b)return">"!==a.current()?null:(a.SkipForward(1),c);for(;!a.eof();){if(a.SkipWhitespace(),a.SkipString("/>"))return c.closed=!0,c;if(a.SkipChar(">"))return c;if(a.Mark(),!a.SkipIdentifier())return null;if(d=a.Extract(),a.SkipWhitespace(),a.SkipChar("="))if(a.SkipWhitespace(),a.SkipChar('"')){if(a.Mark(),!a.Find('"'))return null;c.attributes[d]=a.Extract(),a.SkipForward(1)}else{for(a.Mark();!a.eof()&&!h(a.current())&&">"!==a.current()&&"/"!==a.current();)a.SkipForward(1);a.eof()||(c.attributes[d]=a.Extract())}else c.attributes[d]=""}return null}function C(a,b,c){this.id=a,this.url=b,void 0===c?this.title=null:this.title=c}function D(a,b){var c,d=a.position;return c=E(a,b),null===c&&(a.position=d),c}function E(a,b){var c,d;return a.SkipWhitespace(),a.SkipChar("[")?(a.Mark(),a.Find("]")?(c=a.Extract(),0===c.length?null:a.SkipString("]:")?(d=F(a,c,b),a.SkipLinespace(),a.eol()?d:null):null):null):null}function F(a,b,c){var d,e,f,g,i,j,k,l;if(a.SkipWhitespace(),a.eol())return null;if(d=new C(b),a.SkipChar("<")){for(a.Mark();">"!==a.current();){if(a.eof())return null;a.SkipEscapableChar(c)}if(e=a.Extract(),!a.SkipChar(">"))return null;d.url=n(o(e),c),a.SkipWhitespace()}else{for(a.Mark(),f=1;!a.eol()&&(l=a.current(),!h(l));){if(null===b)if("("===l)f++;else if(")"===l&&(f--,0===f))break;a.SkipEscapableChar(c)}d.url=n(o(a.Extract()),c)}if(a.SkipLinespace(),")"===a.current())return d;switch(g=a.eol(),i=a.position,a.eol()&&(a.SkipEol(),a.SkipLinespace()),a.current()){case"'":case'"':j=a.current();break;case"(":j=")";break;default:return g?(a.position=i,d):null}for(a.SkipForward(1),a.Mark();;){if(a.eol())return null;if(a.current()===j){if(")"!==j){if(k=a.position,a.SkipForward(1),a.SkipLinespace(),null===b&&")"!==a.current()||null!==b&&!a.eol())continue;a.position=k}break}a.SkipEscapableChar(c)}return d.title=n(a.Extract(),c),a.SkipForward(1),d}function G(a,b){this.def=a,this.linkText=b}function H(a,b,c){this.type=a,this.startOffset=b,this.length=c,this.data=null}function I(a){this.markdown=a,this.scanner=new x,this.spareTokens=[],this.disableLinks=!1,this.tokens=[]}function J(){}function K(a,b){this.markdown=a,this.parentType=wa,this.hasMarkdownInHtml=b}function L(){this.columns=[],this.headers=null,this.rows=[]}function M(a){if(a.SkipLinespace(),"|"!==a.current()&&":"!==a.current()&&"-"!==a.current())return null;var b,c,d,e=null;for(a.SkipChar("|")&&(e=new L,e.LeadingBar=!0);;){if(a.SkipLinespace(),"|"===a.current())return null;for(b=a.SkipChar(":");"-"===a.current();)a.SkipForward(1);if(c=a.SkipChar(":"),a.SkipLinespace(),d=na,b&&c?d=qa:b?d=oa:c&&(d=pa),a.eol())return null===e?null:(e.columns.push(d),e);if(!a.SkipChar("|"))return null;if(null===e&&(e=new L),e.columns.push(d),a.SkipLinespace(),a.eol())return e.TrailingBar=!0,e}}var N,O,P,Q,R=1,S=2,T=4,U=8,V=R,W=S,X=T,Y=U,Z=0,$=1,_=2,aa=3,ba=4,ca=5,da=6,ea=7,fa=8,ga=9,ha=10,ia=11,ja=12,ka=13,la=14,ma=15,na=0,oa=1,pa=2,qa=3,ra=0,sa=1,ta=2,ua=3,va=4,wa=0,xa=1,ya=2,za=3,Aa=4,Ba=5,Ca=6,Da=7,Ea=8,Fa=9,Ga=10,Ha=11,Ia=12,Ja=13,Ka=14,La=15,Ma=16,Na=17,Oa=18,Pa=19,Qa=20,Ra=21,Sa=22,Ta=23,Ua=24,Va=25,Wa=26,Xa=27,Ya=28,Za=29,$a=30,_a=function(a){var c,d,e,f,g,h,i=new b;for(i.UserBreaks=!0,d=i.ProcessBlocks(a),e=[],f=0,c=0;c<d.length;c++)g=d[c],g.blockType===La&&(h=g.lineStart,e.push(b.substr(f,h-f).trim()),c+1<d.length?(f=d[c+1].lineStart,0===f&&(f=d[c+1].contentStart)):f=b.length);return a.length>f&&e.push(b.substring(f).trim()),e};b.prototype={SafeMode:!1,ExtraMode:!0,MarkdownInHtml:!1,AutoHeadingIDs:!1,UrlBaseLocation:null,UrlRootLocation:null,NewWindowForExternalLinks:!1,NewWindowForLocalLinks:!1,NoFollowLinks:!1,NoFollowExternalLinks:!1,HtmlClassFootnotes:"footnotes",HtmlClassTitledImages:null,RenderingTitledImage:!1,FormatCodeBlockAttributes:null,FormatCodeBlock:null,ExtractHeadBlocks:!1,UserBreaks:!1,HeadBlockContent:""},N=b.prototype,b.prototype.GetListItems=function(a,b){var d,e,f,g,h=this.ProcessBlocks(a),i=[];for(d=0;d<h.length;d++)if(f=h[d],f.blockType!==Ua&&f.blockType!==Ma&&f.blockType!==Ta||!f.children){if(b<f.lineStart)break}else h=c(h,d,1,f.children),d--;if(d--,0>d)return null;if(f=h[d],f.blockType!==Sa&&f.blockType!==Ra)return null;for(g=f.children,e=0;e<g.length;e++)i.push(g[e].lineStart);return d++,d<h.length?i.push(h[d].lineStart):i.push(a.length),i},b.prototype.Transform=function(a){var b,c,d,e,f,g,h,i,j,k,l,m=a.indexOf("\r");if(m>=0&&(c=a.indexOf("\n"),c>=0&&(a=m>c?a.replace(/\n\r/g,"\n"):a.replace(/\r\n/g,"\n")),a=a.replace(/\r/g,"\n")),this.HeadBlockContent="",d=this.ProcessBlocks(a),e=this.abbreviations,null!==e){f=[];for(g in e)e.hasOwnProperty(g)&&f.push(e[g]);f.sort(function(a,b){return b.Abbr.length-a.Abbr.length}),this.abbreviations=f}for(h=this.stringBuilderFinal,h.Clear(),b=0;b<d.length;b++)i=d[b],i.Render(this,h);if(this.usedFootnotes.length>0){for(h.Append('\n<div class="'),h.Append(this.HtmlClassFootnotes),h.Append('">\n'),h.Append("<hr />\n"),h.Append("<ol>\n"),b=0;b<this.usedFootnotes.length;b++)j=this.usedFootnotes[b],h.Append('<li id="fn:'),h.Append(j.data),h.Append('">\n'),k='<a href="#fnref:'+j.data+'" rev="footnote">&#8617;</a>',l=j.children[j.children.length-1],l.blockType===Ia?(l.blockType=$a,l.data=k):(l=new J,l.contentLen=0,l.blockType=$a,l.data=k,j.children.push(l)),j.Render(this,h),h.Append("</li>\n");h.Append("</ol>\n"),h.Append("</div>\n")}return h.ToString()},b.prototype.OnQualifyUrl=function(a){if(t(a,"#"))return a;if(v(a))return a;if(t(a,"/")){var b,c=this.UrlRootLocation;if(!c){if(!this.UrlBaseLocation)return a;b=this.UrlBaseLocation.indexOf("://"),-1===b?b=0:b+=3,b=this.UrlBaseLocation.indexOf("/",b),c=0>b?this.UrlBaseLocation:this.UrlBaseLocation.substr(0,b)}return c+a}return this.UrlBaseLocation?u(this.UrlBaseLocation,"/")?this.UrlBaseLocation+a:this.UrlBaseLocation+"/"+a:a},b.prototype.OnGetImageSize=function(){return null},b.prototype.OnPrepareLink=function(a){var b=a.attributes.href;this.NoFollowLinks&&(a.attributes.rel="nofollow"),this.NoFollowExternalLinks&&v(b)&&(a.attributes.rel="nofollow"),(this.NewWindowForExternalLinks&&v(b)||this.NewWindowForLocalLinks&&!v(b))&&(a.attributes.target="_blank"),a.attributes.href=this.OnQualifyUrl(b)},b.prototype.OnPrepareImage=function(a,b){var c=this.OnGetImageSize(a.attributes.src,b);void 0!==c&&null!==c&&(a.attributes.width=c.width,a.attributes.height=c.height),a.attributes.src=this.OnQualifyUrl(a.attributes.src)},b.prototype.GetLinkDefinition=function(a){return this.linkDefinitions.hasOwnProperty(a)?this.linkDefinitions[a]:null},N.ProcessBlocks=function(a){return this.linkDefinitions=[],this.footnotes=[],this.usedFootnotes=[],this.usedHeaderIDs=[],this.abbreviations=null,new K(this,this.MarkdownInHtml).Process(a)},N.AddLinkDefinition=function(a){this.linkDefinitions[a.id]=a},N.AddFootnote=function(a){this.footnotes[a.data]=a},N.ClaimFootnote=function(a){var b=this.footnotes[a];return void 0!==b?(this.usedFootnotes.push(b),delete this.footnotes[a],this.usedFootnotes.length-1):-1},N.AddAbbreviation=function(a,b){null===this.abbreviations&&(this.abbreviations=[]),this.abbreviations[a]={Abbr:a,Title:b}},N.GetAbbreviations=function(){return this.abbreviations},N.MakeUniqueHeaderID=function(a,b,c){var d,e,f;if(!this.AutoHeadingIDs)return null;for(d=this.spanFormatter.MakeID(a,b,c),d||(d="section"),e=d,f=1;void 0!==this.usedHeaderIDs[e];)e=d+"-"+f.toString(),f++;return this.usedHeaderIDs[e]=!0,e},N.GetStringBuilder=function(){return this.stringBuilder.Clear(),this.stringBuilder},N=w.prototype,N.Append=function(a){a&&this.content.push(a)},N.Clear=function(){this.content.length=0},N.ToString=function(){return this.content.join("")},N.HtmlRandomize=function(a){var b,c,d=a.length;for(b=0;d>b;b++)c=Math.random(),c>.9&&"@"!==a.charAt(b)?this.Append(a.charAt(b)):c>.45?(this.Append("&#"),this.Append(a.charCodeAt(b).toString()),this.Append(";")):(this.Append("&#x"),this.Append(a.charCodeAt(b).toString(16)),this.Append(";"))},N.HtmlEncode=function(a,b,c){var d,e=b+c,f=b;for(d=b;e>d;d++)switch(a.charAt(d)){case"&":d>f&&this.Append(a.substr(f,d-f)),this.Append("&amp;"),f=d+1;break;case"<":d>f&&this.Append(a.substr(f,d-f)),this.Append("&lt;"),f=d+1;break;case">":d>f&&this.Append(a.substr(f,d-f)),this.Append("&gt;"),f=d+1;break;case'"':d>f&&this.Append(a.substr(f,d-f)),this.Append("&quot;"),f=d+1}d>f&&this.Append(a.substr(f,d-f))},N.SmartHtmlEncodeAmpsAndAngles=function(a,b,c){var d,e,f=b+c,g=b;for(d=b;f>d;d++)switch(a.charAt(d)){case"&":e=m(a,d),0>e?(d>g&&this.Append(a.substr(g,d-g)),this.Append("&amp;"),g=d+1):d=e-1;break;case"<":d>g&&this.Append(a.substr(g,d-g)),this.Append("&lt;"),g=d+1;break;case">":d>g&&this.Append(a.substr(g,d-g)),this.Append("&gt;"),g=d+1;break;case'"':d>g&&this.Append(a.substr(g,d-g)),this.Append("&quot;"),g=d+1}d>g&&this.Append(a.substr(g,d-g))},N.SmartHtmlEncodeAmps=function(a,b,c){var d,e,f=b+c,g=b;for(d=b;f>d;d++)switch(a.charAt(d)){case"&":e=m(a,d),0>e?(d>g&&this.Append(a.substr(g,d-g)),this.Append("&amp;"),g=d+1):d=e-1}d>g&&this.Append(a.substr(g,d-g))},N.HtmlEncodeAndConvertTabsToSpaces=function(a,b,c){var d,e=b+c,f=b,g=0;for(d=b;e>d;d++){switch(a.charAt(d)){case"	":for(d>f&&this.Append(a.substr(f,d-f)),f=d+1,this.Append(" "),g++;g%4!==0;)this.Append(" "),g++;g--;break;case"\r":case"\n":d>f&&this.Append(a.substr(f,d-f)),this.Append("\n"),f=d+1;continue;case"&":d>f&&this.Append(a.substr(f,d-f)),this.Append("&amp;"),f=d+1;break;case"<":d>f&&this.Append(a.substr(f,d-f)),this.Append("&lt;"),f=d+1;break;case">":d>f&&this.Append(a.substr(f,d-f)),this.Append("&gt;"),f=d+1;break;case'"':d>f&&this.Append(a.substr(f,d-f)),this.Append("&quot;"),f=d+1}g++}d>f&&this.Append(a.substr(f,d-f))},N=x.prototype,N.bof=function(){return this.position===this.start},N.eof=function(){return this.position>=this.end},N.eol=function(){if(this.position>=this.end)return!0;var a=this.buf.charAt(this.position);return"\r"===a||"\n"===a||void 0===a||""===a},N.reset=function(){this.buf=arguments.length>0?arguments[0]:null,this.start=arguments.length>1?arguments[1]:0,this.end=arguments.length>2?this.start+arguments[2]:null===this.buf?0:this.buf.length,this.position=this.start,this.charsetOffsets={}},N.current=function(){return this.position>=this.end?"\x00":this.buf.charAt(this.position)},N.remainder=function(){return this.buf.substr(this.position)},N.SkipToEof=function(){this.position=this.end},N.SkipForward=function(a){this.position+=a},N.SkipToEol=function(){this.position=this.buf.indexOf("\n",this.position),this.position<0&&(this.position=this.end)},N.SkipEol=function(){var a=this.position;return"\r"===this.buf.charAt(this.position)&&this.position++,"\n"===this.buf.charAt(this.position)&&this.position++,this.position!==a},N.SkipToNextLine=function(){this.SkipToEol(),this.SkipEol()},N.CharAtOffset=function(a){return this.position+a>=this.end?"\x00":this.buf.charAt(this.position+a)},N.SkipChar=function(a){return this.buf.charAt(this.position)===a?(this.position++,!0):!1},N.SkipString=function(a){return this.buf.substr(this.position,a.length)===a?(this.position+=a.length,!0):!1},N.SkipWhitespace=function(){for(var a,b=this.position;;){if(a=this.buf.charAt(this.position)," "!==a&&"	"!==a&&"\r"!==a&&"\n"!==a)break;this.position++}return this.position!==b},N.SkipLinespace=function(){for(var a,b=this.position;;){if(a=this.buf.charAt(this.position)," "!==a&&"	"!==a)break;this.position++}return this.position!==b},N.FindRE=function(a){a.lastIndex=this.position;var b=a.exec(this.buf);return void 0===b||null===b?(this.position=this.end,!1):b.index+b[0].length>this.end?(this.position=this.end,!1):(this.position=b.index,!0)},N.FindOneOf=function(a){var b,c,d=-1;for(b in a)a.hasOwnProperty(b)&&(c=a[b],void 0!==c&&null!==c||(c={},c.searchedFrom=-1,c.foundAt=-1,a[b]=c),(-1===c.searchedFrom||this.position<c.searchedFrom||this.position>=c.foundAt&&-1!==c.foundAt)&&(c.searchedFrom=this.position,c.foundAt=this.buf.indexOf(b,this.position)),(-1===d||c.foundAt<d)&&(d=c.foundAt));return-1===d?!1:(N.position=d,!0)},N.Find=function(a){return this.position=this.buf.indexOf(a,this.position),this.position<0?(this.position=this.end,!1):!0},N.Mark=function(){this.mark=this.position},N.Extract=function(){return this.mark>=this.position?"":this.buf.substr(this.mark,this.position-this.mark)},N.SkipIdentifier=function(){var a=this.buf.charAt(this.position);if(a>="a"&&"z">=a||a>="A"&&"Z">=a||"_"===a)for(this.position++;;){if(a=this.buf.charAt(this.position),!(a>="a"&&"z">=a||a>="A"&&"Z">=a||"_"===a||a>="0"&&"9">=a))return!0;this.position++}return!1},N.SkipFootnoteID=function(){var a,b,c=this.position;for(this.SkipLinespace(),this.Mark();;){if(a=this.current(),!g(a)&&"-"!==a&&"_"!==a&&":"!==a&&"."!==a&&" "!==a)break;this.SkipForward(1)}return this.position>this.mark&&(b=o(this.Extract()),b.length>0)?(this.SkipLinespace(),b):(this.position=c,null)},N.SkipHtmlEntity=function(){if("&"!==this.buf.charAt(this.position))return!1;var a=m(this.buf,this.position);return 0>a?!1:(this.position=a,!0)},N.SkipEscapableChar=function(a){return"\\"===this.buf.charAt(this.position)&&l(this.buf.charAt(this.position+1),a)?(this.position+=2,!0):(this.position<this.end&&this.position++,!1)},N=y.prototype,N.AttributeCount=function(){var a,b,c=this.attributes;if(!c)return 0;a=0;for(b in c)c.hasOwnProperty(b)&&a++;return a},N.GetFlags=function(){return 0===this.flags&&(this.flags=O[this.name.toLowerCase()],void 0===this.flags&&(this.flags=S)),this.flags},N.IsSafe=function(){var a,b,c,d=this.name.toLowerCase();if(!P[d])return!1;if(a=Q[d],!a)return 0===this.AttributeCount();if(b=this.attributes,!b)return!0;for(c in b)if(b.hasOwnProperty(c)&&!a[c.toLowerCase()])return!1;return b.href&&!z(b.href)?!1:!b.src||z(b.src)},N.RenderOpening=function(a){a.Append("<"),a.Append(this.name);var b,c=this.attributes;for(b in c)c.hasOwnProperty(b)&&(a.Append(" "),a.Append(b),a.Append('="'),a.Append(c[b]),a.Append('"'));this.closed?a.Append(" />"):a.Append(">")},N.RenderClosing=function(a){a.Append("</"),a.Append(this.name),a.Append(">")},P={b:1,blockquote:1,code:1,dd:1,dt:1,dl:1,del:1,em:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,i:1,kbd:1,li:1,ol:1,ul:1,p:1,pre:1,s:1,sub:1,sup:1,strong:1,strike:1,img:1,a:1},Q={a:{href:1,title:1,"class":1},img:{src:1,width:1,height:1,alt:1,title:1,"class":1}},O={p:V|Y,div:V,h1:V|Y,h2:V|Y,h3:V|Y,h4:V|Y,h5:V|Y,h6:V|Y,blockquote:V,pre:V,table:V,dl:V,ol:V,ul:V,form:V,fieldset:V,iframe:V,script:V|W,noscript:V|W,math:V|W,ins:V|W,del:V|W,img:V|W,li:Y,dd:Y,dt:Y,td:Y,th:Y,legend:Y,address:Y,hr:V|X,"!":V|X,head:V},N=C.prototype,N.RenderLink=function(a,b,c){var d,e;"mailto:"===this.url.substr(0,7).toLowerCase()?(b.Append('<a href="'),b.HtmlRandomize(this.url),b.Append('"'),this.title&&(b.Append(' title="'),b.SmartHtmlEncodeAmpsAndAngles(this.title,0,this.title.length),b.Append('"')),b.Append(">"),b.HtmlRandomize(c),b.Append("</a>")):(d=new y("a"),e=a.GetStringBuilder(),e.SmartHtmlEncodeAmpsAndAngles(this.url,0,this.url.length),d.attributes.href=e.ToString(),this.title&&(e.Clear(),e.SmartHtmlEncodeAmpsAndAngles(this.title,0,this.title.length),d.attributes.title=e.ToString()),a.OnPrepareLink(d),d.RenderOpening(b),b.Append(c),b.Append("</a>"))},N.RenderImg=function(a,b,c){var d,e=new y("img");d=a.GetStringBuilder(),d.SmartHtmlEncodeAmpsAndAngles(this.url,0,this.url.length),e.attributes.src=d.ToString(),c&&(d.Clear(),d.SmartHtmlEncodeAmpsAndAngles(c,0,c.length),e.attributes.alt=d.ToString()),this.title&&(d.Clear(),d.SmartHtmlEncodeAmpsAndAngles(this.title,0,this.title.length),e.attributes.title=d.ToString()),e.closed=!0,a.OnPrepareImage(e,a.RenderingTitledImage),e.RenderOpening(b)},N=I.prototype,N.FormatParagraph=function(a,b,c,d){if(this.Tokenize(b,c,d),1===this.tokens.length&&null!==this.markdown.HtmlClassTitledImages&&this.tokens[0].type===ha){var e=this.tokens[0].data;a.Append('<div class="'),a.Append(this.markdown.HtmlClassTitledImages),a.Append('">\n'),this.markdown.RenderingTitledImage=!0,this.Render(a,b),this.markdown.RenderingTitledImage=!1,a.Append("\n"),e.def.title&&(a.Append("<p>"),a.SmartHtmlEncodeAmpsAndAngles(e.def.title,0,e.def.title.length),a.Append("</p>\n")),a.Append("</div>\n")}else a.Append("<p>"),this.Render(a,b),a.Append("</p>\n")},N.Format2=function(a,b){this.Format(a,b,0,b.length)},N.Format=function(a,b,c,d){this.Tokenize(b,c,d),this.Render(a,b)},N.FormatDirect=function(a){var b=new w;return this.Format(b,a,0,a.length),b.ToString()},N.MakeID=function(a,b,c){this.Tokenize(a,b,c);var d,e,h,i,k,l=this.tokens;for(k=new w,d=0;d<l.length;d++){switch(e=l[d],e.type){case Z:k.Append(a.substr(e.startOffset,e.length));break;case ga:k.Append(e.data.linkText)}this.FreeToken(e)}for(h=this.scanner,h.reset(k.ToString());!h.eof()&&!f(h.current());)h.SkipForward(1);for(k.Clear();!h.eof();){if(i=h.current(),g(i)||"_"===i||"-"===i||"."===i)k.Append(i.toLowerCase());else if(" "===i)k.Append("-");else if(j(i)){k.Append("-"),h.SkipEol();continue}h.SkipForward(1)}return k.ToString()},N.Render=function(a,b){var c,d,e,f,g,h,i=this.tokens;for(c=i.length,d=0;c>d;d++){switch(e=i[d],f=e.data,e.type){case Z:a.HtmlEncode(b,e.startOffset,e.length);break;case $:a.SmartHtmlEncodeAmps(b,e.startOffset,e.length);break;case _:case ia:case ja:case ka:a.Append(b.substr(e.startOffset,e.length));break;case fa:a.Append("<br />\n");break;case aa:a.Append("<em>");break;case ba:a.Append("</em>");break;case ca:a.Append("<strong>");break;case da:a.Append("</strong>");break;case ea:a.Append("<pre><code>"),a.HtmlEncode(b,e.startOffset,e.length),a.Append("</code></pre>");break;case ga:g=new I(this.markdown),g.disableLinks=!0,f.def.RenderLink(this.markdown,a,g.FormatDirect(f.linkText));break;case ha:f.def.RenderImg(this.markdown,a,f.linkText);break;case la:h=e.data,a.Append('<sup id="fnref:'),a.Append(h.id),a.Append('"><a href="#fn:'),a.Append(h.id),a.Append('" rel="footnote">'),a.Append(h.index+1),a.Append("</a></sup>");break;case ma:a.Append("<abbr"),f.Title&&(a.Append(' title="'),a.HtmlEncode(f.Title,0,f.Title.length),a.Append('"')),a.Append(">"),a.HtmlEncode(f.Abbr,0,f.Abbr.length),a.Append("</abbr>")}this.FreeToken(e)}},N.Tokenize=function(a,b,c){var d,e,f,h,i,k,m,n,o,p,q,r,s,t=this.scanner,u=null;for(t.reset(a,b,c),d=this.tokens,d.length=0,e=null,f=this.markdown.GetAbbreviations(),null===f&&(u=/[\*\_\`\[\!<\&\ \\]/g),h=this.markdown.ExtraMode,i=t.position;!t.eof()&&(null===u||t.FindRE(u));){switch(k=t.position,m=null,t.current()){case"*":case"_":if(m=this.CreateEmphasisMark(),null!==m)switch(m.type){case ka:case ia:case ja:null===e&&(e=[]),e.push(m)}break;case"`":m=this.ProcessCodeSpan();break;case"[":case"!":o=t.position,m=this.ProcessLinkOrImageOrFootnote(),null===m&&(t.position=o);break;case"<":n=t.position,p=A(t),null!==p?!this.markdown.SafeMode||p.IsSafe()?m=this.CreateToken($,n,t.position-n):t.position=n:(t.position=n,m=this.ProcessAutoLink(),null===m&&(t.position=n));break;case"&":n=t.position,t.SkipHtmlEntity()&&(m=this.CreateToken(_,n,t.position-n));break;case" ":" "===t.CharAtOffset(1)&&j(t.CharAtOffset(2))&&(t.SkipForward(2),t.eof()||(t.SkipEol(),m=this.CreateToken(fa,k,0)));break;case"\\":l(t.CharAtOffset(1),h)&&(m=this.CreateToken(Z,t.position+1,1),t.SkipForward(2))}if(null===m&&null!==f&&!g(t.CharAtOffset(-1))){q=t.position;for(r in f)if(f.hasOwnProperty(r)){if(s=f[r],t.SkipString(s.Abbr)&&!g(t.current())){m=this.CreateDataToken(ma,s);break}t.position=q}}null!==m?(k>i&&d.push(this.CreateToken(Z,i,k-i)),d.push(m),i=t.position):t.SkipForward(1)}t.position>i&&d.push(this.CreateToken(Z,i,t.position-i)),null!==e&&this.ResolveEmphasisMarks(d,e)},N.CreateEmphasisMark=function(){var a,b,c,d=this.scanner,e=d.current(),f=d.position;if(d.bof()||h(d.CharAtOffset(-1))){for(;k(d.current());)d.SkipForward(1);if(d.eof()||h(d.current()))return this.CreateToken(_,f,d.position-f);d.position=f}for(;k(d.CharAtOffset(-1));)d.SkipForward(-1);for(a=d.bof()||h(d.CharAtOffset(-1)),d.position=f;d.current()===e;)d.SkipForward(1);for(b=d.position-f;k(d.CharAtOffset(1));)d.SkipForward(1);return c=d.eof()||h(d.current()),d.position=f+b,a?this.CreateToken(ia,f,d.position-f):c?this.CreateToken(ja,f,d.position-f):this.markdown.ExtraMode&&"_"===e&&g(d.current())?null:this.CreateToken(ka,f,d.position-f)},N.SplitMarkToken=function(b,c,d,e){var f=this.CreateToken(d.type,d.startOffset+e,d.length-e);return d.length=e,c.splice(a(c,d)+1,0,f),b.splice(a(b,d)+1,0,f),f},N.ResolveEmphasisMarks=function(b,c){for(var d,e,f,g,h,i=this.scanner.buf,j=!0;j;)for(j=!1,d=0;d<c.length;d++)if(e=c[d],e.type===ia||e.type===ka)for(f=d+1;f<c.length&&(g=c[f],g.type===ja||g.type===ka);f++)if(i.charAt(e.startOffset)===i.charAt(g.startOffset)){h=Math.min(e.length,g.length),h>=3&&(h=h%2===1?1:2),e.length>h&&(e=this.SplitMarkToken(b,c,e,e.length-h),d--),g.length>h&&this.SplitMarkToken(b,c,g,h),e.type=1===h?aa:ca,g.type=1===h?ba:da,c.splice(a(c,e),1),c.splice(a(c,g),1),j=!0;break}},N.ProcessAutoLink=function(){if(this.disableLinks)return null;var a,b,c,d,e,f=this.scanner;for(f.SkipForward(1),f.Mark(),a=this.markdown.ExtraMode;!f.eof()&&(b=f.current(),!h(b));){if(">"===b)return c=n(f.Extract(),a),d=null,p(c)?("mailto:"===c.toLowerCase().substr(0,7)?e=c.substr(7):(e=c,c="mailto:"+c),d=new G(new C("auto",c,null),e)):q(c)&&(d=new G(new C("auto",c,null),c)),null!==d?(f.SkipForward(1),this.CreateDataToken(ga,d)):null;f.SkipEscapableChar(a)}return null},N.ProcessLinkOrImageOrFootnote=function(){var a,b,c,d,e,f,g,i,j,k,l,m,o,p=this.scanner,q=p.SkipChar("!")?ha:ga;if(!p.SkipChar("["))return null;if(a=this.position,this.markdown.ExtraMode&&q===ga&&p.SkipChar("^")){if(p.SkipLinespace(),p.Mark(),i=p.SkipFootnoteID(),null!==i&&p.SkipChar("]")&&(j=this.markdown.ClaimFootnote(i),j>=0))return this.CreateDataToken(la,{index:j,id:i});this.position=a}if(this.disableLinks&&q===ga)return null;for(b=this.markdown.ExtraMode,p.Mark(),c=1;!p.eof();){if(d=p.current(),"["===d)c++;else if("]"===d&&(c--,0===c))break;p.SkipEscapableChar(b)}if(p.eof())return null;if(e=n(p.Extract(),b),p.SkipForward(1),a=p.position,p.SkipChar("("))return f=F(p,null,this.markdown.ExtraMode),null===f?null:(p.SkipWhitespace(),p.SkipChar(")")?this.CreateDataToken(q,new G(f,e)):null);if(p.SkipChar(" ")||p.SkipChar("	"),p.eol()&&(p.SkipEol(),p.SkipLinespace()),g=null,"["===p.current()){if(p.SkipForward(1),p.Mark(),!p.Find("]"))return null;g=p.Extract(),p.SkipForward(1)}else p.position=a;if(!g)for(g=e;;){if(k=g.indexOf("\n"),0>k)break;for(l=k;l>0&&h(g.charAt(l-1));)l--;for(m=k;m<g.length&&h(g.charAt(m));)m++;g=g.substr(0,l)+" "+g.substr(m)}return o=this.markdown.GetLinkDefinition(g),null===o?null:this.CreateDataToken(q,new G(o,e))},N.ProcessCodeSpan=function(){for(var a,b,c,d=this.scanner,e=d.position,f=0;d.SkipChar("`");)f++;if(d.SkipWhitespace(),d.eof())return this.CreateToken(Z,e,d.position-e);if(a=d.position,!d.Find(d.buf.substr(e,f)))return this.CreateToken(Z,e,d.position-e);for(b=d.position+f;h(d.CharAtOffset(-1));)d.SkipForward(-1);return c=this.CreateToken(ea,a,d.position-a),d.position=b,c},N.CreateToken=function(a,b,c){if(0!==this.spareTokens.length){var d=this.spareTokens.pop();return d.type=a,d.startOffset=b,d.length=c,d.data=null,d}return new H(a,b,c)},N.CreateDataToken=function(a,b){var c;return 0!==this.spareTokens.length?(c=this.spareTokens.pop(),c.type=a,c.data=b,c):(c=new H(a,0,0),c.data=b,c)},N.FreeToken=function(a){a.data=null,this.spareTokens.push(a)},N=J.prototype,N.buf=null,N.blockType=wa,N.contentStart=0,N.contentLen=0,N.lineStart=0,N.lineLen=0,N.children=null,N.data=null,N.GetContent=function(){return null===this.buf?null:-1===this.contentStart?this.buf:this.buf.substr(this.contentStart,this.contentLen)},N.GetCodeContent=function(){var a,b=new w;for(a=0;a<this.children.length;a++)b.Append(this.children[a].GetContent()),b.Append("\n");return b.ToString()},N.RenderChildren=function(a,b){for(var c=0;c<this.children.length;c++)this.children[c].Render(a,b)},N.ResolveHeaderID=function(a){if("string"==typeof this.data)return this.data;var b,c=s(this.buf,this.contentStart,this.GetContentEnd());return void 0!==c&&null!==c?(this.SetContentEnd(c.end),b=c.id):b=a.MakeUniqueHeaderID(this.buf,this.contentStart,this.contentLen),this.data=b,b},N.Render=function(a,b){var c,d,e,f,g,h,i,j;switch(this.blockType){case wa:return;case Ia:a.spanFormatter.FormatParagraph(b,this.buf,this.contentStart,this.contentLen);break;case Oa:a.spanFormatter.Format(b,this.buf,this.contentStart,this.contentLen),b.Append("\n");break;case xa:case ya:case za:case Aa:case Ba:case Ca:a.ExtraMode&&!a.SafeMode?(b.Append("<h"+(this.blockType-xa+1).toString()),d=this.ResolveHeaderID(a),d?(b.Append(' id="'),b.Append(d),b.Append('">')):b.Append(">")):b.Append("<h"+(this.blockType-xa+1).toString()+">"),a.spanFormatter.Format(b,this.buf,this.contentStart,this.contentLen),b.Append("</h"+(this.blockType-xa+1).toString()+">\n");break;case Ka:return void b.Append("<hr />\n");case La:return;case Ga:case Ha:b.Append("<li>"),a.spanFormatter.Format(b,this.buf,this.contentStart,this.contentLen),b.Append("</li>\n");break;case Ma:b.Append(this.buf.substr(this.contentStart,this.contentLen));break;case Na:return void b.HtmlEncode(this.buf,this.contentStart,this.contentLen);case Pa:for(b.Append("<pre><code"),null!==a.FormatCodeBlockAttributes&&b.Append(a.FormatCodeBlockAttributes(this.data)),b.Append(">"),e=b,a.FormatCodeBlock&&(e=b,b=new w),c=0;c<this.children.length;c++)h=this.children[c],b.HtmlEncodeAndConvertTabsToSpaces(h.buf,h.contentStart,h.contentLen),b.Append("\n");a.FormatCodeBlock&&(e.Append(a.FormatCodeBlock(b.ToString(),this.data)),b=e),b.Append("</code></pre>\n\n");break;case Fa:b.Append("<blockquote>\n"),this.RenderChildren(a,b),b.Append("</blockquote>\n");break;case Qa:return b.Append("<li>\n"),this.RenderChildren(a,b),void b.Append("</li>\n");case Ra:return b.Append("<ol>\n"),this.RenderChildren(a,b),void b.Append("</ol>\n");case Sa:return b.Append("<ul>\n"),this.RenderChildren(a,b),void b.Append("</ul>\n");case Ta:return f=this.data,g=f.name.toLowerCase(),"a"===g?a.OnPrepareLink(f):"img"===g&&a.OnPrepareImage(f,a.RenderingTitledImage),f.RenderOpening(b),b.Append("\n"),this.RenderChildren(a,b),f.RenderClosing(b),void b.Append("\n");case Ua:case Za:return void this.RenderChildren(a,b);case Va:return void this.data.Render(a,b);case Wa:b.Append("<dd>"),null!==this.children?(b.Append("\n"),this.RenderChildren(a,b)):a.spanFormatter.Format(b,this.buf,this.contentStart,this.contentLen),b.Append("</dd>\n");break;case Xa:if(null===this.children)for(i=this.GetContent().split("\n"),c=0;c<i.length;c++)j=i[c],b.Append("<dt>"),a.spanFormatter.Format2(b,o(j)),b.Append("</dt>\n");else b.Append("<dt>\n"),this.RenderChildren(a,b),b.Append("</dt>\n");break;case Ya:return b.Append("<dl>\n"),this.RenderChildren(a,b),void b.Append("</dl>\n");case $a:b.Append("<p>"),this.contentLen>0&&(a.spanFormatter.Format(b,this.buf,this.contentStart,this.contentLen),b.Append("&nbsp;")),b.Append(this.data),b.Append("</p>\n")}},N.RevertToPlain=function(){this.blockType=Ia,this.contentStart=this.lineStart,this.contentLen=this.lineLen},N.GetContentEnd=function(){return this.contentStart+this.contentLen},N.SetContentEnd=function(a){this.contentLen=a-this.contentStart},N.GetLeadingSpaces=function(){var a,b=0;for(a=this.lineStart;a<this.lineStart+this.lineLen&&" "===this.buf.charAt(a);a++)b++;return b},N.CopyFrom=function(a){return this.blockType=a.blockType,this.buf=a.buf,this.contentStart=a.contentStart,this.contentLen=a.contentLen,this.lineStart=a.lineStart,this.lineLen=a.lineLen,this},N=K.prototype,N.Process=function(a){var b=new x(a);return this.ScanLines(b)},N.ProcessRange=function(a,b,c){var d=new x(a,b,c);return this.ScanLines(d)},N.StartTable=function(a,b,c){if(c.length>1)return!1;var d,e;if(1===c.length){if(d=a.position,a.position=c[0].lineStart,b.headers=b.ParseRow(a),null===b.headers)return!1;a.position=d,c.length=0}for(;;){if(d=a.position,e=b.ParseRow(a),null===e){a.position=d;break}b.rows.push(e)}return!0},N.ScanLines=function(a){for(var b,c,d,e,f,g,h=[],i=[],j=-1;!a.eof();)if(b=j===wa,c=this.EvaluateLine(a),j=c.blockType,c.blockType===Wa&&(c.data=b),c.blockType!==Da&&c.blockType!==Ea){if(e=i.length>0?i[0].blockType:wa,c.blockType===Va){if(f=c.data,g=a.position,this.StartTable(a,f,i)){h.push(c);continue}a.position=g,c.RevertToPlain()}switch(c.blockType){case wa:switch(e){case wa:this.FreeBlock(c);break;case Ia:this.CollapseLines(h,i),this.FreeBlock(c);break;case Fa:case Ga:case Ha:case Wa:case Za:case Ja:i.push(c)}break;case Ia:switch(e){case wa:case Ia:i.push(c);break;case Fa:case Ga:case Ha:case Wa:case Za:d=i[i.length-1],d.blockType===wa?(this.CollapseLines(h,i),i.push(c)):i.push(c);break;case Ja:this.CollapseLines(h,i),i.push(c)}break;case Ja:switch(e){case wa:i.push(c);break;case Ia:case Fa:d=i[i.length-1],d.blockType===wa?(this.CollapseLines(h,i),i.push(c)):(c.RevertToPlain(),i.push(c));break;case Ga:case Ha:case Ja:case Wa:case Za:i.push(c)}break;case Fa:e!==Fa&&this.CollapseLines(h,i),i.push(c);break;case Ga:case Ha:switch(e){case wa:i.push(c);break;case Ia:case Fa:d=i[i.length-1],d.blockType===wa||this.parentType===Ga||this.parentType===Ha||this.parentType===Wa?(this.CollapseLines(h,i),
i.push(c)):(c.RevertToPlain(),i.push(c));break;case Ga:case Ha:c.blockType!==Ga&&c.blockType!==Ha&&this.CollapseLines(h,i),i.push(c);break;case Wa:case Za:c.blockType!==e&&this.CollapseLines(h,i),i.push(c);break;case Ja:this.CollapseLines(h,i),i.push(c)}break;case Wa:case Za:switch(e){case wa:case Ia:case Wa:case Za:this.CollapseLines(h,i),i.push(c);break;default:c.RevertToPlain(),i.push(c)}break;default:this.CollapseLines(h,i),h.push(c)}}else{if(i.length>0&&(d=i.pop(),this.CollapseLines(h,i),d.blockType!==wa)){d.RevertToPlain(),d.blockType=c.blockType===Da?xa:ya,h.push(d);continue}c.blockType===Da&&(c.RevertToPlain(),i.push(c))}return this.CollapseLines(h,i),this.markdown.ExtraMode&&this.BuildDefinitionLists(h),h},N.CreateBlock=function(a){var b;return b=this.markdown.spareBlocks.length>1?this.markdown.spareBlocks.pop():new J,b.lineStart=a,b},N.FreeBlock=function(a){this.markdown.spareBlocks.push(a)},N.FreeBlocks=function(a){for(var b=0;b<a.length;b++)this.markdown.spareBlocks.push(a[b]);a.length=0},N.RenderLines=function(a){var b,c,d=this.markdown.GetStringBuilder();for(b=0;b<a.length;b++)c=a[b],d.Append(c.buf.substr(c.contentStart,c.contentLen)),d.Append("\n");return d.ToString()},N.CollapseLines=function(a,b){for(var c,d,e,f,g,h,i,j,k;b.length>0&&b[b.length-1].blockType===wa;)this.FreeBlock(b.pop());if(0!==b.length)switch(b[0].blockType){case Ia:c=this.CreateBlock(b[0].lineStart),c.blockType=Ia,c.buf=b[0].buf,c.contentStart=b[0].contentStart,c.SetContentEnd(b[b.length-1].GetContentEnd()),a.push(c),this.FreeBlocks(b);break;case Fa:d=this.RenderLines(b),e=new K(this.markdown,this.hasMarkdownInHtml),e.parentType=Fa,k=this.CreateBlock(b[0].lineStart),k.blockType=Fa,k.children=e.Process(d),this.FreeBlocks(b),a.push(k);break;case Ga:case Ha:a.push(this.BuildList(b));break;case Wa:if(a.length>0)switch(f=a[a.length-1],f.blockType){case Ia:f.blockType=Xa;break;case Wa:break;default:g=this.CreateBlock(f.lineStart),g.blockType=Xa,g.children=[],g.children.push(f),a.pop(),a.push(g)}a.push(this.BuildDefinition(b));break;case Za:this.markdown.AddFootnote(this.BuildFootnote(b));break;case Ja:for(h=this.CreateBlock(b[0].lineStart),h.blockType=Pa,h.children=[],i=b[0].GetContent(),"{{"===i.substr(0,2)&&"}}"===i.substr(i.length-2,2)&&(h.data=i.substr(2,i.length-4),b.splice(0,1)),j=0;j<b.length;j++)h.children.push(b[j]);a.push(h),b.length=0}},N.EvaluateLine=function(a){var b=this.CreateBlock(a.position);return b.buf=a.buf,b.contentStart=a.position,b.contentLen=-1,b.blockType=this.EvaluateLineInternal(a,b),b.contentLen<0&&(a.SkipToEol(),b.contentLen=a.position-b.contentStart),b.lineLen=a.position-b.lineStart,a.SkipEol(),b},N.EvaluateLineInternal=function(a,b){if(a.eol())return wa;var c,e,f,g,j,k,l,m,n,p,q,r,t,u=a.position;if(c=a.current(),"#"===c){for(j=1,a.SkipForward(1);"#"===a.current();)j++,a.SkipForward(1);for(j>6&&(j=6),a.SkipLinespace(),b.contentStart=a.position,a.SkipToEol(),this.markdown.ExtraMode&&!this.markdown.SafeMode&&(k=s(a.buf,b.contentStart,a.position),null!==k&&(b.data=k.id,a.position=k.end));a.position>b.contentStart&&"#"===a.CharAtOffset(-1);)a.SkipForward(-1);for(;a.position>b.contentStart&&h(a.CharAtOffset(-1));)a.SkipForward(-1);return b.contentLen=a.position-b.contentStart,a.SkipToEol(),xa+(j-1)}if("-"===c||"="===c){for(e=c;a.current()===e;)a.SkipForward(1);if(a.SkipLinespace(),a.eol())return"="===e?Da:Ea;a.position=u}if(this.markdown.ExtraMode){if(l=M(a),null!==l)return b.data=l,Va;if(a.position=u,"~"===c||"`"===c){if(this.ProcessFencedCodeBlock(a,b))return b.blockType;a.position=u}}for(f=-1,g=0;!a.eol();){if(" "===a.current())0>f&&g++;else{if("	"!==a.current())break;0>f&&(f=a.position)}a.SkipForward(1)}if(a.eol())return b.contentLen=0,wa;if(g>=4)return b.contentStart=u+4,Ja;if(f>=0&&4>f-u)return b.contentStart=f+1,Ja;if(b.contentStart=a.position,c=a.current(),"<"===c){if(this.ScanHtml(a,b))return b.blockType;a.position=b.contentStart}if(">"===c)return i(a.CharAtOffset(1))?(a.SkipForward(2),b.contentStart=a.position,Fa):(a.SkipForward(1),b.contentStart=a.position,Fa);if("-"===c||"_"===c||"*"===c){for(m=0;!a.eol();)if(e=a.current(),a.current()!==c){if(!i(a.current()))break;a.SkipForward(1)}else m++,a.SkipForward(1);if(a.eol()&&m>=3)return this.markdown.UserBreaks?La:Ka;a.position=b.contentStart}if(this.markdown.ExtraMode&&"*"===c&&"["===a.CharAtOffset(1)){for(a.SkipForward(2),a.SkipLinespace(),a.Mark();!a.eol()&&"]"!==a.current();)a.SkipForward(1);if(n=o(a.Extract()),"]"===a.current()&&":"===a.CharAtOffset(1)&&n)return a.SkipForward(2),a.SkipLinespace(),a.Mark(),a.SkipToEol(),p=a.Extract(),this.markdown.AddAbbreviation(n,p),wa;a.position=b.contentStart}if(("*"===c||"+"===c||"-"===c)&&i(a.CharAtOffset(1)))return a.SkipForward(1),a.SkipLinespace(),b.contentStart=a.position,Ha;if(":"===c&&this.markdown.ExtraMode&&i(a.CharAtOffset(1)))return a.SkipForward(1),a.SkipLinespace(),b.contentStart=a.position,Wa;if(d(c)){for(a.SkipForward(1);d(a.current());)a.SkipForward(1);if(a.SkipChar(".")&&a.SkipLinespace())return b.contentStart=a.position,Ga;a.position=b.contentStart}if("["===c){if(this.markdown.ExtraMode&&"^"===a.CharAtOffset(1)){if(q=a.position,a.SkipForward(2),r=a.SkipFootnoteID(),null!==r&&a.SkipChar("]")&&a.SkipChar(":"))return a.SkipLinespace(),b.contentStart=a.position,b.data=r,Za;a.position=q}if(t=D(a,this.markdown.ExtraMode),null!==t)return this.markdown.AddLinkDefinition(t),wa}return Ia},N.GetMarkdownMode=function(a){var b=a.attributes.markdown;return void 0===b?this.hasMarkdownInHtml?ua:ra:(delete a.attributes.markdown,"1"===b?0!==(a.GetFlags()&U)?ta:sa:"block"===b?sa:"deep"===b?ua:"span"===b?ta:va)},N.ProcessMarkdownEnabledHtml=function(a,b,c,d){for(var e,f,g,h,i=a.position,j=1,k=!1;!a.eof()&&a.Find("<");)if(e=a.position,f=A(a),null!==f){if(this.markdown.SafeMode&&d===va&&!k&&(f.IsSafe()||(k=!0)),!f.closed&&f.name===c.name)if(f.closing){if(j--,0===j){switch(a.SkipLinespace(),a.SkipEol(),b.blockType=Ta,b.data=c,b.SetContentEnd(a.position),d){case ta:g=this.CreateBlock(i),g.buf=a.buf,g.blockType=Oa,g.contentStart=i,g.contentLen=e-i,b.children=[],b.children.push(g);break;case sa:case ua:h=new K(this.markdown,d===ua),b.children=h.ProcessRange(a.buf,i,e-i);break;case va:k?(b.blockType=Na,b.SetContentEnd(a.position)):(g=this.CreateBlock(i),g.buf=a.buf,g.blockType=Ma,g.contentStart=i,g.contentLen=e-i,b.children=[],b.children.push(g))}return!0}}else j++}else a.SkipForward(1);return!1},N.ScanHtml=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,p,q=a.position;if(c=A(a),null===c)return!1;if(c.closing)return!1;if(d=!1,this.markdown.SafeMode&&!c.IsSafe()&&(d=!0),e=c.GetFlags(),0===(e&R))return!1;if(0!==(e&T)||c.closed)return a.SkipLinespace(),a.SkipEol(),b.contentLen=a.position-b.contentStart,b.blockType=d?Na:Ma,!0;if(0!==(e&S)&&(a.SkipLinespace(),!a.eol()))return!1;if(f=this.markdown.ExtractHeadBlocks&&"head"===c.name.toLowerCase(),g=a.position,!f&&this.markdown.ExtraMode&&(h=this.GetMarkdownMode(c),h!==ra))return this.ProcessMarkdownEnabledHtml(a,b,c,h);for(i=null,j=1;!a.eof()&&a.Find("<");)if(l=a.position,k=A(a),null!==k){if(this.markdown.SafeMode&&!k.IsSafe()&&(d=!0),!k.closed){if(!f&&!k.closing&&this.markdown.ExtraMode&&!d&&(h=this.GetMarkdownMode(k),h!==ra)){if(n=this.CreateBlock(q),this.ProcessMarkdownEnabledHtml(a,n,k,h)){null===i&&(i=[]),l>q&&(m=this.CreateBlock(q),m.buf=a.buf,m.blockType=Ma,m.contentStart=q,m.contentLen=l-q,i.push(m)),i.push(n),q=a.position;continue}this.FreeBlock(n)}if(k.name===c.name&&!k.closed)if(k.closing){if(j--,0===j)return a.SkipLinespace(),a.SkipEol(),d?(b.blockType=Na,b.SetContentEnd(a.position),!0):null!==i?(a.position>q&&(m=this.CreateBlock(q),m.buf=a.buf,m.blockType=Ma,m.contentStart=q,m.contentLen=a.position-q,i.push(m)),b.blockType=Ua,b.SetContentEnd(a.position),b.children=i,!0):f?(p=a.buf.substr(g,l-g),this.markdown.HeadBlockContent=this.markdown.HeadBlockContent+o(p)+"\n",b.blockType=Ma,b.contentStart=a.position,b.contentEnd=a.position,b.lineStart=a.position,!0):(b.blockType=Ma,b.contentLen=a.position-b.contentStart,!0)}else j++}}else a.SkipForward(1);return wa},N.BuildList=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p=a[0].blockType;for(b=a[0].GetLeadingSpaces(),c=1;c<a.length;c++)a[c].blockType!==Ia||a[c-1].blockType!==Ia&&a[c-1].blockType!==Ha&&a[c-1].blockType!==Ga?a[c].blockType!==Ja&&a[c].blockType!==wa&&(m=a[c].GetLeadingSpaces(),m>b&&(a[c].blockType=Ja,n=a[c].GetContentEnd(),a[c].contentStart=a[c].lineStart+m,a[c].SetContentEnd(n))):(a[c-1].SetContentEnd(a[c].GetContentEnd()),this.FreeBlock(a[c]),a.splice(c,1),c--);for(d=this.CreateBlock(0),d.blockType=p===Ha?Sa:Ra,d.children=[],c=0;c<a.length;c++){for(e=c;e>0&&a[e-1].blockType===wa;)e--;for(f=c;f<a.length-1&&a[f+1].blockType!==Ha&&a[f+1].blockType!==Ga;)f++;if(e===f)d.children.push(this.CreateBlock().CopyFrom(a[c]));else{for(g=!1,h=this.markdown.GetStringBuilder(),i=e;f>=i;i++)o=a[i],h.Append(o.buf.substr(o.contentStart,o.contentLen)),h.Append("\n"),a[i].blockType===wa&&(g=!0);if(j=this.CreateBlock(),j.blockType=Qa,j.lineStart=a[e].lineStart,k=new K(this.markdown),k.parentType=p,j.children=k.Process(h.ToString()),!g)for(i=0;i<j.children.length;i++)l=j.children[i],l.blockType===Ia&&(l.blockType=Oa);d.children.push(j)}c=f}return d.lineStart=d.children[0].lineStart,this.FreeBlocks(a),a.length=0,d},N.BuildDefinition=function(a){var b,c,d,e,f,g,h;for(b=1;b<a.length;b++)a[b].blockType!==Ia||a[b-1].blockType!==Ia&&a[b-1].blockType!==Wa||(a[b-1].SetContentEnd(a[b].GetContentEnd()),this.FreeBlock(a[b]),a.splice(b,1),b--);if(c=a[0].data,1===a.length&&!c)return g=a[0],a.length=0,g;for(d=this.markdown.GetStringBuilder(),b=0;b<a.length;b++)h=a[b],d.Append(h.buf.substr(h.contentStart,h.contentLen)),d.Append("\n");return e=this.CreateBlock(a[0].lineStart),e.blockType=Wa,f=new K(this.markdown),f.parentType=Wa,e.children=f.Process(d.ToString()),this.FreeBlocks(a),a.length=0,e},N.BuildDefinitionLists=function(a){var b,c=null;for(b=0;b<a.length;b++)switch(a[b].blockType){case Xa:case Wa:null===c&&(c=this.CreateBlock(a[b].lineStart),c.blockType=Ya,c.children=[],a.splice(b,0,c),b++),c.children.push(a[b]),a.splice(b,1),b--;break;default:c=null}},N.BuildFootnote=function(a){var b,c,d,e,f;for(b=1;b<a.length;b++)a[b].blockType!==Ia||a[b-1].blockType!==Ia&&a[b-1].blockType!==Za||(a[b-1].SetContentEnd(a[b].GetContentEnd()),this.FreeBlock(a[b]),a.splice(b,1),b--);for(c=this.markdown.GetStringBuilder(),b=0;b<a.length;b++)f=a[b],c.Append(f.buf.substr(f.contentStart,f.contentLen)),c.Append("\n");return d=new K(this.markdown),d.parentType=Za,e=this.CreateBlock(a[0].lineStart),e.blockType=Za,e.data=a[0].data,e.children=d.Process(c.ToString()),this.FreeBlocks(a),a.length=0,e},N.ProcessFencedCodeBlock=function(a,b){var c,d,e,f,g=a.position,i=a.current(),k="";for(a.Mark();a.current()===i;)a.SkipForward(1);if(c=a.Extract(),c.length<3)return!1;for(;!h(a.buf.charAt(a.position));)k+=a.buf.charAt(a.position),a.position++;return a.SkipLinespace(),a.eol()?(a.SkipEol(),d=a.position,a.Find(c)&&j(a.CharAtOffset(-1))?(e=a.position,a.SkipForward(c.length),a.SkipLinespace(),a.eol()?(b.blockType=Pa,b.children=[],b.data=k,e--,f=this.CreateBlock(g),f.blockType=Ja,f.buf=a.buf,f.contentStart=d,f.contentLen=e-d,b.children.push(f),!0):!1):!1):!1},N=L.prototype,N.LeadingBar=!1,N.TrailingBar=!1,N.ParseRow=function(a){if(a.SkipLinespace(),a.eol())return null;var b=this.LeadingBar,c=[];if(this.LeadingBar&&!a.SkipChar("|"))return null;for(;!a.eol();){for(a.Mark();!a.eol()&&"|"!==a.current();)a.SkipEscapableChar(!0);c.push(o(a.Extract())),b|=a.SkipChar("|")}if(!b)return null;for(;c.length<this.columns.length;)c.push("&nbsp;");return a.SkipEol(),c},N.RenderRow=function(a,b,c,d){for(var e=0;e<c.length;e++){if(b.Append("	<"),b.Append(d),e<this.columns.length)switch(this.columns[e]){case oa:b.Append(' align="left"');break;case pa:b.Append(' align="right"');break;case qa:b.Append(' align="center"')}b.Append(">"),a.spanFormatter.Format2(b,c[e]),b.Append("</"),b.Append(d),b.Append(">\n")}},N.Render=function(a,b){var c,d;for(b.Append("<table>\n"),null!==this.headers&&(b.Append("<thead>\n<tr>\n"),this.RenderRow(a,b,this.headers,"th"),b.Append("</tr>\n</thead>\n")),b.Append("<tbody>\n"),c=0;c<this.rows.length;c++)d=this.rows[c],b.Append("<tr>\n"),this.RenderRow(a,b,d,"td"),b.Append("</tr>\n");b.Append("</tbody>\n"),b.Append("</table>\n")},this.Markdown=b,this.HtmlTag=y,this.SplitUserSections=_a};"undefined"!=typeof exports&&(exports.Markdown=MarkdownDeep.Markdown,exports.SplitUserSections=MarkdownDeep.SplitUserSections);var MarkdownDeepEditor=new function(){"use strict";function a(a,b){return a.substr(0,b.length)===b}function b(a,b){return a.substr(-b.length)===b}function c(a){return" "===a||"	"===a||"\r"===a||"\n"===a}function d(a){return"\r"===a||"\n"===a}function e(a){for(var b=0,d=a.length;d>b&&c(a.charAt(b));)b++;for(;d-1>b&&c(a.charAt(d-1));)d--;return a.substr(b,d-b)}function f(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)}function g(a){return a.preventDefault&&a.preventDefault(),void 0!==a.cancelBubble&&(a.cancelBubble=!0,a.keyCode=0,a.returnValue=!1),!1}function h(){}function i(a,b,c,d){return b>a?a:b+c>a?b:a+d-c}function j(a,b){a.setSelectionRange||(m=!0),this.LastContent=null,this.UndoStack=[],this.UndoPosition=0,this.UndoMode=C,this.Markdown=new MarkdownDeep.Markdown,this.Markdown.SafeMode=!1,this.Markdown.ExtraMode=!0,this.Markdown.NewWindowForLocalLinks=!0,this.Markdown.NewWindowForExternalLinks=!0,this.Textarea=a,this.PreviewDiv=b;var c=this;f(a,"keyup",function(){c.onMarkdownChanged()}),f(a,"keydown",function(a){return c.onKeyDown(a)}),f(a,"paste",function(){c.onMarkdownChanged()}),f(a,"input",function(){c.onMarkdownChanged()}),f(a,"mousedown",function(){c.SetUndoMode(C)}),this.onMarkdownChanged()}var k,l,m=!1,n=9,o=13,p=33,q=34,r=36,s=35,t=37,u=39,v=38,w=40,x=8,y=46,z=0,A=1,B=2,C=3,D=4,E={Z:"undo",Y:"redo",B:"bold",I:"italic",H:"heading",K:"code",U:"ullist",O:"ollist",Q:"indent",E:"outdent",L:"link",G:"img",R:"hr",0:"h0",1:"h1",2:"h2",3:"h3",4:"h4",5:"h5",6:"h6"};k=h.prototype,k.InitFromTextArea=function(a){var b,c,d;this.Textarea=a,m?(b=document.selection.createRange(),c=b.duplicate(),c.moveToElementText(a),d=-c.moveStart("character",-1e7),this.selectionStart=-b.moveStart("character",-1e7)-d,this.selectionEnd=-b.moveEnd("character",-1e7)-d,this.text=a.value.replace(/\r\n/gm,"\n")):(this.selectionStart=a.selectionStart,this.selectionEnd=a.selectionEnd,this.text=a.value)},k.Duplicate=function(){var a=new h;return a.Textarea=this.Textarea,a.selectionEnd=this.selectionEnd,a.selectionStart=this.selectionStart,a.text=this.text,a},k.Apply=function(){var a,b;m?(this.Textarea.value=this.text,this.Textarea.focus(),a=this.Textarea.createTextRange(),a.collapse(!0),a.moveEnd("character",this.selectionEnd),a.moveStart("character",this.selectionStart),a.select()):(b=this.Textarea.scrollTop,this.Textarea.value=this.text,this.Textarea.focus(),this.Textarea.setSelectionRange(this.selectionStart,this.selectionEnd),this.Textarea.scrollTop=b)},k.ReplaceSelection=function(a){this.text=this.text.substr(0,this.selectionStart)+a+this.text.substr(this.selectionEnd),this.selectionEnd=this.selectionStart+a.length},k.ReplaceAt=function(a,b,c){this.text=this.text.substr(0,a)+c+this.text.substr(a+b),this.selectionStart=i(this.selectionStart,a,b,c.length),this.selectionEnd=i(this.selectionEnd,a,b,c.length)},k.getSelectedText=function(){return this.text.substr(this.selectionStart,this.selectionEnd-this.selectionStart)},k.InflateSelection=function(a,b){this.selectionEnd+=b,this.selectionStart-=a},k.PreceededBy=function(a){return this.selectionStart>=a.length&&this.text.substr(this.selectionStart-a.length,a.length)===a},k.FollowedBy=function(a){return this.text.substr(this.selectionEnd,a.length)===a},k.TrimSelection=function(){for(;c(this.text.charAt(this.selectionStart));)this.selectionStart++;for(;this.selectionEnd>this.selectionStart&&c(this.text.charAt(this.selectionEnd-1));)this.selectionEnd--},k.IsStartOfLine=function(a){return 0===a||d(this.text.charAt(a-1))},k.FindStartOfLine=function(a){for(;a>0&&!d(this.text.charAt(a-1));)a--;return a},k.FindEndOfLine=function(a){for(;a<this.text.length&&!d(this.text.charAt(a));)a++;return a},k.FindNextLine=function(a){return this.SkipEol(this.FindEndOfLine(a))},k.SkipWhiteSpace=function(a){for(;a<this.text.length&&c(this.text.charAt(a));)a++;return a},k.SkipEol=function(a){return"\r\n"===this.text.substr(a,2)?a+2:d(this.text.charAt(a))?a+1:a},k.SkipPreceedingEol=function(a){return a>2&&"\r\n"===this.text.substr(a-2,2)?a-2:a>1&&d(this.text.charAt(a-1))?a-1:a},k.SelectWholeLines=function(){this.selectionStart=this.FindStartOfLine(this.selectionStart),this.IsStartOfLine(this.selectionEnd)||(this.selectionEnd=this.SkipEol(this.FindEndOfLine(this.selectionEnd)))},k.SkipPreceedingWhiteSpace=function(a){for(;a>0&&c(this.text.charAt(a-1));)a--;return a},k.SkipFollowingWhiteSpace=function(a){for(;c(this.text.charAt(a));)a++;return a},k.SelectSurroundingWhiteSpace=function(){this.selectionStart=this.SkipPreceedingWhiteSpace(this.selectionStart),this.selectionEnd=this.SkipFollowingWhiteSpace(this.selectionEnd)},k.CheckSimpleSelection=function(){var a=this.getSelectedText(),b=a.match(/\n[ \t\r]*\n/);return b?(alert("Please make a selection that doesn't include a paragraph break"),!1):!0},k.IsBlankLine=function(a){var b,e,f=this.text.length;for(e=a;f>e;e++){if(b=this.text[e],d(b))return!0;if(!c(this.text.charAt(e)))return!1}return!0},k.FindStartOfParagraph=function(a){var b,c=a;if(a=this.FindStartOfLine(a),this.IsBlankLine(a))return a;for(;a>0&&(b=this.FindStartOfLine(this.SkipPreceedingEol(a)),0!==b)&&!this.IsBlankLine(b);)a=b;if(0!==this.DetectListType(a).prefixLen)for(a=this.FindStartOfLine(c);a>0;){if(0!==this.DetectListType(a).prefixLen)return a;a=this.FindStartOfLine(this.SkipPreceedingEol(a))}return a},k.FindEndOfParagraph=function(a){for(;a<this.text.length&&!this.IsBlankLine(a);)a=this.FindNextLine(a);return a},k.SelectParagraph=function(){this.selectionStart=this.FindStartOfParagraph(this.selectionStart),this.selectionEnd=this.FindEndOfParagraph(this.selectionStart)},k.DetectListType=function(a){var b=this.text.substr(a,10),c=b.match(/^\s{0,3}(\*|\d+\.)(?:\ |\t)*/);return c?"*"===c[1]?{listType:"*",prefixLen:c[0].length}:{listType:"1",prefixLen:c[0].length}:{listType:"",prefixLen:0}},k=j.prototype,l=j.prototype,k.onKeyDown=function(a){var b,c=null;if(a.ctrlKey||a.metaKey){if(b=String.fromCharCode(a.charCode||a.keyCode),!this.disableShortCutKeys&&void 0!==E[b])return this.InvokeCommand(E[b]),g(a);switch(b){case"V":c=A;break;case"X":c=B}}else switch(a.keyCode){case n:if(!this.disableTabHandling)return this.InvokeCommand(a.shiftKey?"untab":"tab"),g(a);c=A;break;case t:case u:case v:case w:case r:case s:case p:case q:c=C;break;case x:case y:c=B;break;case o:c=D;break;default:c=A}null!=c&&this.SetUndoMode(c),this.disableAutoIndent||a.keyCode!==o||m&&!a.ctrlKey||this.IndentNewLine()},k.SetUndoMode=function(a){this.UndoMode!==a&&(this.UndoMode=a,this.CaptureUndoState())},k.CaptureUndoState=function(){var a=new h;a.InitFromTextArea(this.Textarea),this.UndoStack.splice(this.UndoPosition,this.UndoStack.length-this.UndoPosition,a),this.UndoPosition=this.UndoStack.length},k.onMarkdownChanged=function(){var a,b=this.Textarea.value;b===this.LastContent&&null!==this.LastContent||(this.onPreTransform&&this.onPreTransform(this,b),a=this.Markdown.Transform(b),this.onPostTransform&&this.onPostTransform(this,a),this.PreviewDiv&&(this.PreviewDiv.innerHTML=a),this.onPostUpdateDom&&this.onPostUpdateDom(this),this.LastContent=b)},l.onOptionsChanged=function(){this.LastContent=null,this.onMarkdownChanged()},l.commandUndo=function(){this.UndoPosition>0&&(this.UndoPosition===this.UndoStack.length&&(this.CaptureUndoState(),this.UndoPosition--),this.UndoPosition--,this.UndoStack[this.UndoPosition].Apply(),this.UndoMode=z,this.onMarkdownChanged())},l.commandRedo=function(){this.UndoPosition+1<this.UndoStack.length&&(this.UndoPosition++,this.UndoStack[this.UndoPosition].Apply(),this.UndoMode=z,this.onMarkdownChanged(),this.UndoPosition===this.UndoStack.length-1&&this.UndoStack.pop())},k.setHeadingLevel=function(a,b){a.SelectParagraph(),a.SelectSurroundingWhiteSpace();var c,d,f,g,h,i,j=a.getSelectedText();if(j=e(j),d=j.match(/^(\#+)(.*?)(\#+)?$/),d?(j=e(d[2]),c=d[1].length):(d=j.match(/^(.*?)(?:\r\n|\n|\r)\s*(\-*|\=*)$/),d?(j=e(d[1]),c="="===d[2].charAt(0)?1:0):(j=j.replace(/(\r\n|\n|\r)/gm,""),c=0)),-1===b&&(b=(c+1)%4),0===b){if("Heading"===j)return a.ReplaceSelection(""),!0;g=j.length,f=0}else{for(""===j&&(j="Heading"),f=b+1,g=j.length,h="",i=0;b>i;i++)h+="#";j=h+" "+j+" "+h}return j+="\n\n",0!==a.selectionStart&&(j="\n\n"+j,f+=2),a.ReplaceSelection(j),a.selectionStart+=f,a.selectionEnd=a.selectionStart+g,!0},l.commandHeading=function(a){return this.setHeadingLevel(a,-1)},l.commandH0=function(a){return this.setHeadingLevel(a,0)},l.commandH1=function(a){return this.setHeadingLevel(a,1)},l.commandH2=function(a){return this.setHeadingLevel(a,2)},l.commandH3=function(a){return this.setHeadingLevel(a,3)},l.commandH4=function(a){return this.setHeadingLevel(a,4)},l.commandH5=function(a){return this.setHeadingLevel(a,5)},l.commandH6=function(a){return this.setHeadingLevel(a,6)},k.IndentCodeBlock=function(b,c){var d,f,g,h,i,j=0;for(b.SelectWholeLines(),h=b.getSelectedText().split("\n"),j=0;j<h.length;j++)if("	"===h[j].charAt(0)){for(d="",f=0;"	"===h[j].charAt(f);)d+="    ",f++;g=d+h[j].substr(f),h.splice(j,1,g)}if(null===c){for(j=0;j<h.length;j++)if(""!==e(h[j])){if("	"===h[j].charAt(0)){for(d="",f=0;"	"===h[j].charAt(f);)d+="    ",f++;g=d+h[j].substr(j),h.splice(j,1,g)}if(!a(h[j],"    "))break}c=j!==h.length}for(j=0;j<h.length;j++)""!==e(h[j])&&(i=h[j],c?i="    "+h[j]:a(h[j],"	")?i=h[j].substr(1):a(h[j],"    ")&&(i=h[j].substr(4)),h.splice(j,1,i));b.ReplaceSelection(h.join("\n"))},l.commandCode=function(a){if(a.selectionStart===a.selectionEnd){var b=a.FindStartOfLine(a.selectionStart);if(a.IsBlankLine(b))return a.SelectSurroundingWhiteSpace(),a.ReplaceSelection("\n\n    Code\n\n"),a.selectionStart+=6,a.selectionEnd=a.selectionStart+4,!0}return a.getSelectedText().indexOf("\n")<0?(a.TrimSelection(),a.PreceededBy("`")&&a.selectionStart--,a.FollowedBy("`")&&a.selectionEnd++,this.boldOrItalic(a,"`")):(this.IndentCodeBlock(a,null),!0)},l.commandTab=function(a){if(a.getSelectedText().indexOf("\n")>0)this.IndentCodeBlock(a,!0);else{var b,c,d=a.FindStartOfLine(a.selectionStart);for(b=d;b<a.selectionStart&&" "===a.text.charAt(b);b++);b===a.selectionStart?(c=4-(b-d)%4,a.ReplaceSelection("    ".substr(0,c))):a.ReplaceSelection("	"),a.selectionStart=a.selectionEnd}return!0},l.commandUntab=function(a){return a.getSelectedText().indexOf("\n")>0?(this.IndentCodeBlock(a,!1),!0):!1},k.boldOrItalic=function(c,d){var e=d.length,f=c.getSelectedText();return a(f,d)&&b(f,d)?c.ReplaceSelection(f.substr(e,f.length-2*e)):(c.TrimSelection(),f=c.getSelectedText(),f=f?f.replace(/(\r\n|\n|\r)/gm,""):"text",c.ReplaceSelection(d+f+d),c.InflateSelection(-e,-e)),!0},l.commandBold=function(a){return a.CheckSimpleSelection()?(a.TrimSelection(),a.PreceededBy("**")&&(a.selectionStart-=2),a.FollowedBy("**")&&(a.selectionEnd+=2),this.boldOrItalic(a,"**")):!1},l.commandItalic=function(a){return a.CheckSimpleSelection()?(a.TrimSelection(),(a.PreceededBy("*")&&!a.PreceededBy("**")||a.PreceededBy("***"))&&(a.selectionStart-=1),(a.FollowedBy("*")&&!a.PreceededBy("**")||a.FollowedBy("***"))&&(a.selectionEnd+=1),this.boldOrItalic(a,"*")):!1},k.indentOrOutdent=function(b,c){b.SelectWholeLines();var d,e,f=b.getSelectedText().split("\n");for(d=0;d<f.length-1;d++)e=f[d],c?a(f[d],"> ")&&(e=f[d].substr(2)):e="> "+f[d],f.splice(d,1,e);return b.ReplaceSelection(f.join("\n")),!0},l.commandIndent=function(a){return this.indentOrOutdent(a,!1)},l.commandOutdent=function(a){return this.indentOrOutdent(a,!0)},k.handleList=function(a,b){var c,d,e,f,g,h,i,j,k,l=[];if(a.getSelectedText().indexOf("\n")>0)for(a.SelectWholeLines(),c=a.selectionStart,l.push(c);;){if(c=a.FindNextLine(c),c>=a.selectionEnd)break;l.push(c)}else l.push(a.FindStartOfLine(a.selectionStart));for(f="*"===b?"* ":"1. ",d=0;d<l.length;d++)if(e=a.DetectListType(l[d]),e.listType===b){f="";break}for(d=l.length-1;d>=0;d--)c=l[d],e=a.DetectListType(c),a.ReplaceAt(c,e.prefixLen,f);for(g=new MarkdownDeep.Markdown,g.ExtraMode=!0,h=g.GetListItems(a.text,a.selectionStart);null!=h;){for(i=0,d=0;d<h.length-1&&(e=a.DetectListType(h[d]+i),"1"===e.listType);d++)j=(d+1).toString()+". ",a.ReplaceAt(h[d]+i,e.prefixLen,j),i+=j.length-e.prefixLen;k=g.GetListItems(a.text,h[h.length-1]+i),h=null!=k&&k[0]!==h[0]?k:null}return l.length>1&&a.SelectWholeLines(),!0},l.commandUllist=function(a){return this.handleList(a,"*")},l.commandOllist=function(a){return this.handleList(a,"1")},l.commandLink=function(a){var b,c,d;return a.TrimSelection(),a.CheckSimpleSelection()?(b=prompt("Enter the target URL:"),null===b?!1:(c=a.getSelectedText(),0===c.length&&(c="link text"),d="["+c+"]("+b+")",a.ReplaceSelection(d),a.selectionStart++,a.selectionEnd=a.selectionStart+c.length,!0)):!1},l.commandImg=function(a){var b,c,d;return a.TrimSelection(),a.CheckSimpleSelection()?(b=prompt("Enter the image URL"),null===b?!1:(c=a.getSelectedText(),0===c.length&&(c="Image Text"),d="!["+c+"]("+b+")",a.ReplaceSelection(d),a.selectionStart+=2,a.selectionEnd=a.selectionStart+c.length,!0)):!1},l.commandHr=function(a){return a.SelectSurroundingWhiteSpace(),0===a.selectionStart?a.ReplaceSelection("----------\n\n"):a.ReplaceSelection("\n\n--------\n\n"),a.selectionStart=a.selectionEnd,!0},l.IndentNewLine=function(){var a,b=this,c=function(){var c,d,e,f;for(window.clearInterval(a),c=new h,c.InitFromTextArea(b.Textarea),d=c.FindStartOfLine(c.SkipPreceedingEol(c.selectionStart)),e=d;;){if(f=c.text.charAt(e)," "!==f&&"	"!==f)break;e++}e>d&&(c.ReplaceSelection(c.text.substr(d,e-d)),c.selectionStart=c.selectionEnd),c.Apply()};return a=window.setInterval(c,1),!1},l.commandIndentedNewline=function(a){a.ReplaceSelection("\n"),a.selectionStart=a.selectionEnd;for(var b,c=a.FindStartOfLine(a.SkipPreceedingEol(a.selectionStart)),d=c;;){if(b=a.text.charAt(d)," "!==b&&"	"!==b)break;d++}return d>c&&(a.ReplaceSelection(a.text.substr(c,d-c)),a.selectionStart=a.selectionEnd),!0},l.InvokeCommand=function(a){var b,c,d=("command "+a).replace(/(?:^\w|[A-Z]|\b\w|\s+)/g,function(a,b){return 0===+a?"":0===b?a.toLowerCase():a.toUpperCase()});return"undo"===a||"redo"===a?(this[d](),this.Textarea.focus(),!0):(b=new h,b.InitFromTextArea(this.Textarea),c=b.Duplicate(),this[d](b)?(this.UndoMode=z,this.UndoStack.splice(this.UndoPosition,this.UndoStack.length-this.UndoPosition,c),this.UndoPosition++,b.Apply(),this.onMarkdownChanged(),!0):(this.Textarea.focus(),!1))},this.Editor=j},MarkdownDeepEditorUI=new function(){"use strict";this.ToolbarHtml=function(){return'<ul class="mdd_buttons">\n<li><i class="fa fa-undo mdd_undo" title="Undo (Ctrl+Z)"></i></li>\n<li><i class="fa fa-repeat mdd_redo" title="Redo (Ctrl+Y)"></i></li>\n<li><span class="mdd_sep"></span></li>\n<li><i class="fa fa-header mdd_heading" title="Change Heading Style (Ctrl+H, or Ctrl+0 to Ctrl+6)"></i></li>\n<li><i class="fa fa-code mdd_code" title="Preformatted Code (Ctrl+K or Tab/Shift+Tab on multiline selection)"></i></li>\n<li><span class="mdd_sep"></span></li>\n<li><i class="fa fa-bold mdd_bold" title="Bold (Ctrl+B)"></i></li>\n<li><i class="fa fa-italic mdd_italic" title="Italic (Ctrl+I)"></i></li>\n<li><span class="mdd_sep"></span></li>\n<li><i class="fa fa-list-ul mdd_ullist" title="Bullets (Ctrl+U)"></i></li>\n<li><i class="fa fa-list-o mdd_ollist" title="Numbering (Ctrl+O)"></i></li>\n<li><i class="fa fa-outdent mdd_outdent" title="Unquote (Ctrl+W)"></i></li>\n<li><i class="fa fa-indent mdd_indent" title="Quote (Ctrl+Q)"></i></li>\n<li><span class="mdd_sep"></span></li>\n<li><i class="fa fa-link mdd_link" title="Insert Hyperlink (Ctrl+L)"></i></li>\n<li><i class="fa fa-picture-o mdd_img" title="Insert Image (Ctrl+G)"></i></li>\n<li><i class="fa fa-arrows-h mdd_hr" title="Insert Horizontal Rule (Ctrl+R)"></i></li>\n<li><span class="mdd_sep"></span></li>\n<li><i class="mdd_help fa fa-question"></i></li>\n</ul>\n<div style="clear:both"></div>\n'},this.onToolbarButton=function(a){var b,c=$(a.target).closest("div.mdd_toolbar_wrap").next(".mdd_editor_wrap").children("textarea").data("mdd");return b=$(a.target).attr("class").match(/mdd_[\w-]*\b/)[0].substr(4),"help"===b?(window.open("https://guides.github.com/features/mastering-markdown/","help"),!1):(c.InvokeCommand(b),!1)}};!function(a){"use strict";a.fn.MarkdownDeep=function(b){var c={toolbar:!0,preview:!0};return b&&a.extend(c,b),this.each(function(d){var e,f,g,h,i=a(this).parent(".mdd_editor_wrap"),j=null;0===i.length&&(i=a(this).wrap('<div class="mdd_editor_wrap" />').parent()),c.toolbar&&(e=i.prev(".mdd_toolbar_wrap"),f=i.prev(".mdd_toolbar"),0===e.length?(0===f.length&&(f=a('<div class="mdd_toolbar" />'),f.insertBefore(i)),f.wrap('<div class="mdd_toolbar_wrap" />').parent()):0===f.length&&(f=a('<div class="mdd_toolbar" />'),e.html(f)),f.append(a(MarkdownDeepEditorUI.ToolbarHtml())),a(".mdd_buttons i",f).click(MarkdownDeepEditorUI.onToolbarButton)),c.preview===!0&&(g=a(this).attr("data-mdd-preview"),g||(g=".mdd_preview"),j=a(g)[d],j||(a('<div class="mdd_preview"></div>').insertAfter(this),j=a(".mdd_preview")[d])),h=new MarkdownDeepEditor.Editor(this,j),b&&(jQuery.extend(h.Markdown,b),jQuery.extend(h,b)),h.onOptionsChanged(),a(this).data("mdd",h)})}}(jQuery);